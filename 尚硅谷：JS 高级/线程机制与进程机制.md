### 线程
- 是进程内的一个独立执行单元
- 是程序执行的一个完整流程
- 是 CPU 的最小调度单元

### 线程与进程
- 应用程序必须运行在某个进程的某个线程上
- 一个进程中至少有一个运行的线程：主线程，进程启动后自动创建
- 一个进程中也可以同时运行多个线程，我们会说程序是多线程运行的
- 一个进程内的数据可以供其中的多个线程直接共享
- 多个进程直接的数据是不能直接共享的
- 线程池：保存多个线程对象的容器，实现线程对象的反复利用


- JS 是单线程运行的，但使用 H5 中的 Web Workers 可以多线程运行
- 浏览器是多线程运行的
- 浏览器有的的单进程的（Firefox、旧IE），有的是多进程的（Chrome、新IE）


### 浏览器内核的组成模块
- 主线程
    - JS 引擎：负责 JS 程序的编译和运行
    - HTML & CSS 文档解析：负责页面文本的解析
    - DOM / CSS：负责 DOM / CSS 在内存中的相关处理
    - 布局和渲染：负责页面的布局和效果的绘制（内存中的对象）
- 分线程
    - 定时器
    - 事件响应
    - 网络请求：负责 ajax 请求

### JS 引擎执行代码的基本流程
- 先执行初始化代码，包含一些特别的代码
    - 设置定时器
    - 绑定监听
    - 发送 ajax 请求
- 后面在某个时刻才会执行回调代码

### 事件循环模型
- 执行栈
- 浏览器内核
- 任务队列
- 消息队列
- 事件队列
- 事件轮询
- 事件驱动模型
- 请求响应模型

### H5 Web Workers
- Web Workers 是 HTML5 提供的一个 JavaScript 多线程解决方案，我们可以将一些大计算量的代码交由 Web Workers 运行而不冻结用户界面，但是子线程完全受主线程控制，且不能操作 DOM。所有这个标准并没有改变 JavaScript 单线程的本质。
```JavaScript
// main.js
var worker = new Worker('worker.js')
worker.postMessage(...)                    // 第 1 步
worker.onMessage = function (event) {...}  // 第 4 步

// worker.js
var onMessage = function (event) {
    ...                                   // 第 2 步
    postMessage(...)                      // 第 3 步
}
```
- 注意：在 `worker.js` 中无法调用 window 对象的方法，因为分线程中的全局对象不再是 window，所以不可能在分线程改变界面（DOM）
- 缺点
    - 慢
    - 不能跨域加载 JS
    - worker 内代码不能访问 DOM
    - 有些浏览器（低版本）不支持
